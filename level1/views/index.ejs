<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body>
  <div class="container page-todo">
      <div class="col-sm-7 tasks">
        <div class="task-list">
          <h1 id="heading">Tasks</h1>
          <div class="wrap">
            <div class="search">
               <input type="text" class="searchTerm" id="searchTerm" placeholder="What are you looking for?">
               <button type="submit" class="searchButton">
                 <i class="fa fa-search"></i>
              </button>
            </div> 
            <p id="searchMsg" class="none"></p>
          </div>
          <div class="result">
            <div class="priority high"><span>High priority</span></div>
            <div class="task high">
              <div class="desc">
                <div class="title">Viết Report ABC</div>
                <div>Viết report cho challenge A</div>
              </div>
              <div class="time">
                <div class="date">Jun 1, 2012</div>
                <div> 1 day</div>
              </div>
            </div>
            <div class="priority medium"><span>Medium priority</span></div>
            <div class="task medium">
              <div class="desc">
                <div class="title">Làm labs cho lỗi X</div>
                <div>Lỗi này phức tạp nên làm 3 level thôi</div>
              </div>
              <div class="time">
                <div class="date">Jun 1, 2012</div>
                <div> 1 day</div>
              </div>
            </div>
            <div class="task medium last">
              <div class="desc">
                <div class="title">Deploy labs lên server</div>
                <div>Deploy nhanh để đi ăn cơm</div>
              </div>
              <div class="time">
                <div class="date">Jun 1, 2012</div>
                <div> 1 day</div>
              </div>
            </div>
            <div class="priority low"><span>Low priority</span></div>
            <div class="task low">
              <div class="desc">
                <div class="title">Research về lỗi Z</div>
                <div>Lỗi này quằn nên cho thời gian dài xíu</div>
              </div>
              <div class="time">
                <div class="date">Jun 1, 2012</div>
                <div> 1 day</div>
              </div>
            </div>
          </div>
          <div class="clearfix"></div>		
        </div>		
      </div>
  </div>
  <script>
    const searchMsg = document.getElementById("searchMsg");
    const searchTerm = document.getElementById("searchTerm");
    const url = new URL(location.href);
    const keyword = url.searchParams.get("keyword");

    if (keyword) {
      const resultElem = document.getElementsByClassName("result")[0];
      fetch("/api/search?keyword=" + keyword)
        .then(response => response.json())
        .then(({isEmpty, results}) => {
          if (!isEmpty) {
            searchMsg.classList.remove("hidden");
            searchMsg.innerHTML = `Search results for ${keyword}:`;
            resultElem.innerHTML = "";

            results.forEach(result => resultElem.innerHTML += `
            <div class="task">
              <div class="desc">
                <div class="title">${result.title}</div>
                <div>${result.description}</div>
              </div>
              <div class="time">
                <div class="date">${result.assignedDate}</div>
                <div> ${result.daysLeft > 1 ? result.daysLeft + "days" : result.daysLeft + "day"}</div>
              </div>
            </div>
            `)
          } else {
            searchMsg.classList.remove("hidden");
            searchMsg.innerHTML = `No results for ${keyword}`;
          }
        })
      
    }

    searchTerm.addEventListener("keypress", e => {
      if (e.key != "Enter") return;
      if (searchTerm.value) {
        document.location.href = "/?keyword="+searchTerm.value; 
      }
    });
  </script>
  </body>
</html>
